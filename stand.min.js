!function(a){"function"==typeof define&&define.amd?define(["raphael","underscore"],a):a(Raphael,underscore)}(function(a){function b(a,b){for(var c=a.centerX,d=a.centerY,e=a.count,f=a.deg,g=a.r,h=0;e>h;h++){var i=2*Math.PI/360*f*h,j=c+Math.sin(i)*g,k=d-Math.cos(i)*g;b(j,k,h)}}function c(a){var b=a.from.toString().replace(","," "),c=a.to.toString().replace(","," ");return"M"+b+"L"+c}function d(a){for(var b="",c=65,d=_.keys(a).length;64+d>c;c++)b+=String.fromCharCode(c)+" ";return b.trim().split(" ").reverse().toString().replace(/,/g,"")}function e(a){this.conf=_.extend(e.DEFAULTS,a);var b=this.init(this.conf),c=this.conf,d=f(b,c);g(b,c),h(b,d,c),i(b,d,c),d.attr("stroke-width",1.5),j(b,c),k(b,c)}function f(a,b){var c=a.set();return c.push(a.circle(b.centerX,b.centerY,b.r),a.circle(b.centerX,b.centerY,b.sr),a.circle(b.centerX,b.centerY,b.fr)),c.glow({width:1,offsety:3,offsetx:-2,opacity:.3}),c}function g(a,d){var e=a.set(),f=a.set(),g=[],h=[],i=[];b({centerX:d.centerX,centerY:d.centerY,count:d.figureCount,deg:360/d.figureCount,r:d.r},function(a,b){h.push({x:a,y:b})}),b({centerX:d.centerX,centerY:d.centerY,count:d.figureCount,deg:360/d.figureCount,r:d.sr},function(a,b){i.push({x:a,y:b})}),b({centerX:d.centerX,centerY:d.centerY,count:d.figureCount,deg:360/d.figureCount,r:d.r-5},function(a,b){g.push({x:a,y:b})});for(var j=0;20>j;j++){var k=c({from:[i[j].x,i[j].y],to:[g[j].x,g[j].y]}),l=c({from:[g[j].x,g[j].y],to:[h[j].x,h[j].y]});e.push(a.path(k)),f.push(a.path(l))}e.attr("stroke-width",5),f.attr("stroke-width",5);var m=0,n=function(a){m>10||(setTimeout(function(){n(3*m+100)},a+30),e.forEach(function(b,c){var d=e[c],g=f[c],h=c+1==e.length?e[0]:e[c+1],i=0==c?f[f.length-1]:f[c-1];d.animate({path:h.attr("path")[0].toString().replace(","," ")+h.attr("path")[1].toString().replace(","," ")},a,"easeOut"),g.animate({path:i.attr("path")[0].toString().replace(","," ")+i.attr("path")[1].toString().replace(","," ")},a,"easeOut")}),m++)};n(80)}function h(a,d,e){return b({centerX:e.centerX,centerY:e.centerY,count:e.count,deg:e.deg,r:e.fr},function(b,f){var g=c({from:[e.centerX,e.centerY],to:[b,f]});d.push(a.path(g))}),d}function i(a,c,d){d.levelArr=[];for(var e=0;e<d.levleTotal;e++){var f=d.levleWidth*(e+1);b({centerX:d.centerX,centerY:d.centerY,count:d.count,deg:d.deg,r:f},function(b,e){d.levelArr.push({x:b,y:e}),c.push(a.circle(b,e,1))})}}function j(a,c){var d=_.keys(c.data.status),e=_.values(c.data.status);b({centerX:c.centerX,centerY:c.centerY,count:c.count,deg:c.deg,r:c.r-40},function(b,d,f){var g=c.levelCode.charAt(e[f]-1);a.text(b,d,g).attr("font-size",18).attr("font-weight","bold")}),b({centerX:c.centerX,centerY:c.centerY,count:c.count,deg:c.deg,r:c.r-20},function(b,e,f){var g=d[f],h=f*c.deg;h>=90&&270>=h&&(h-=180),a.text(b,e,g).attr("font-weight","bold").transform("r"+h)})}function k(a,b){var c=b.centerX,d=b.centerY,e=b.count,f=(b.deg,b.r,b.levleWidth,b.levleTotal,b.levelArr),g=b.data,h=[],i=[],j=1;for(var k in g.status){var l=g.status[k],m=l*e-(e-j)-1,n=f[m];i.push(f[(j-1)*e]),h.push(n),j++}for(var o=0;o<i.length-1;o++){var p=b.levelCode.charAt(o);a.text(i[o].x+5,i[o].y,p).attr("font-size",10)}for(var q="M"+c+" "+d,r="M"+h[0].x.toString()+" "+h[0].y.toString(),s=1;s<h.length;s++)r+="L"+h[s].x.toString()+" "+h[s].y.toString(),q+="L"+c+" "+d;var t=a.path(q+"Z").animate({path:r+"Z"},1500,"easeOut");t.attr("fill",g.theme).attr("fill-opacity",.3),t.toBack()}return e.DEFAULTS={id:"main",centerX:200,centerY:200,count:6,r:150,width:980,height:600,levleTotal:5,figureCount:20},e.prototype.init=function(b){return b.sr=b.r-10,b.fr=b.r/1.6,b.deg=360/b.count,b.levleWidth=b.fr/(b.levleTotal+1),b.levelCode=d(b.data.status),this.paper=a(b.id,b.width,b.height),this.paper},e});